services:
  # ===========================
  # ðŸš€ Backend (FastAPI + Cloud SQL)
  # ===========================
  - type: web
    name: legalbot-backend
    env: docker
    plan: free
    dockerfilePath: ./Dockerfile.backend
    autoDeploy: true
    envVars:
      # ==========================
      # App Environment
      # ==========================
      - key: APP_ENV
        value: prod

      # ==========================
      # Database (Cloud SQL)
      # ==========================
      - key: POSTGRES_HOST
        value: 34.93.244.73
      - key: POSTGRES_PORT
        value: 5432
      - key: POSTGRES_DB
        value: legal_chunks_db_v2
      - key: POSTGRES_USER
        value: legalbot_user
      - key: POSTGRES_PASSWORD
        value: Google@123
      - key: DB_URL
        value: postgresql+psycopg2://legalbot_user:Google%40123@34.93.244.73:5432/legal_chunks_db_v2

      # ==========================
      # URLs
      # ==========================
      - key: FRONTEND_URL
        value: https://legalbot-frontend-fajw.onrender.com
      - key: BACKEND_URL
        value: https://legalbot-backend-ew4x.onrender.com

      # ==========================
      # Google OAuth (Handled via Render Dashboard)
      # ==========================
      - key: GOOGLE_CLIENT_ID
        sync: false
      - key: GOOGLE_CLIENT_SECRET
        sync: false
      - key: GOOGLE_REDIRECT_URI
        value: https://legalbot-backend-ew4x.onrender.com/api/v1/auth/google/callback

      # ==========================
      # JWT Config
      # ==========================
      - key: JWT_SECRET_KEY
        value: supersecretkey123
      - key: JWT_ALGORITHM
        value: HS256
      - key: JWT_EXPIRATION_MINUTES
        value: "60"

      # ==========================
      # LLM Config
      # ==========================
      - key: OPENAI_API_KEY
        sync: false
      - key: OPENAI_MODEL
        value: gpt-4o-mini

    healthCheckPath: /api/v1/health/

  # ===========================
  # ðŸ’» Frontend (React / Vite + Nginx)
  # ===========================
  - type: web
    name: legalbot-frontend
    env: docker
    plan: free
    dockerfilePath: ./Dockerfile.frontend
    autoDeploy: true
    envVars:
      # ==========================
      # App Environment
      # ==========================
      - key: APP_ENV
        value: prod

      # ==========================
      # Frontend Config
      # ==========================
      - key: VITE_API_BASE_URL
        value: https://legalbot-backend-ew4x.onrender.com/api/v1
      - key: VITE_FRONTEND_URL
        value: https://legalbot-frontend-fajw.onrender.com

      # ==========================
      # Google Auth Config
      # ==========================
      - key: VITE_GOOGLE_CLIENT_ID
        sync: false
      - key: VITE_GOOGLE_REDIRECT_URI
        value: https://legalbot-backend-ew4x.onrender.com/api/v1/auth/google/callback

      # ==========================
      # Cache / Versioning
      # ==========================
      - key: CACHE_BUST
        value: oct25-final

    buildFilter:
      paths:
        - legalbot/web/**
